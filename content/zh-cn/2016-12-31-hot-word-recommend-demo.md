---
layout: post
title: "ä¸€ä¸ªçƒ­è¯æ¨èçš„ç®€å•å®ç°"
Description: ""
date: 2016-12-31
tags: [çƒ­è¯æ¨è]
comments: true
share: true
---

#### ä¸ºä»€ä¹ˆæƒ³åšè¿™ä¸ªä¸œè¥¿

ä¸€ç›´å¥½å¥‡åƒäºšé©¬é€Šè¿™ç±»ç½‘ç«™çš„æœç´¢æ˜¯å¦‚ä½•åšåˆ°æ¨èçš„ï¼Œæœ€è¿‘åˆšå¥½çœ‹åˆ°ä¸€ç¯‡æ–‡ç« ï¼š[Redis ä¸æœç´¢çƒ­è¯æ¨è](http://blog.jobbole.com/95780/)ï¼Œç„¶è€Œåªå†™äº†æ€è·¯ã€‚æ‰€ä»¥ï¼Œå°±æ˜¯æƒ³è‡ªå·±å®ç°ä¸€ä¸ªã€‚

å…ˆä¸Šä¸ªæ•ˆæœå›¾ï¼Œå†èŠï¼š

![](/assets/images/index.lsp.gif)

P.S. æŒ‰å››å¹´å‰ï¼Œè¦å†™è¿™æ ·çš„å‰ç«¯æ•ˆæœï¼Œå¯¹äºæˆ‘è¿™ä¸ªåå°å¼€å‘ï¼Œè¿˜æ˜¯æŒºå›°éš¾çš„ã€‚è€Œç°åœ¨ï¼Œç®€å•çš„å­¦äº†ä¸‹Vue.jsï¼Œå†åŠ ä¸ŠåŒäº‹çš„å°å°æŒ‡ç‚¹ï¼Œå°±æå®šäº†ã€‚ğŸ˜‚

#### çƒ­è¯æ¨èçš„æœ¬è´¨

å‡å¦‚ä½ é¢„å…ˆå°±çŸ¥é“äº†ç”¨æˆ·è¾“å…¥ï¼šsã€szã€shenã€æ·±è¿™äº›å­—æ—¶ï¼Œå°±æ˜¯æƒ³æœâ€œæ·±åœ³â€ï¼Œé‚£æ˜¯ä¸æ˜¯è¯´ï¼Œæˆ‘ä»¬åªè¦æå‰å°†è¿™äº›å­—æ”¾åˆ°ä¸€ä¸ªMapç»“æ„ä¸­ï¼Œå°†ç”¨æˆ·çš„è¾“å…¥æƒ³åƒå‡ºä¸€ä¸ªkeyï¼Œvalueå°±æ˜¯â€œæ·±åœ³â€ã€‚

è¯´åˆ°åº•ï¼Œçƒ­è¯æ¨èçš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ªå¤§å¤§çš„Mapã€‚**éš¾ç‚¹å°±åœ¨äºå¦‚ä½•æ›´æ–°è¿™ä¸ªMap**ï¼Œä»¥è‡³äºè®©ç”¨æˆ·è§‰å¾—â€œæ™ºèƒ½â€ï¼Œæˆ–è§‰å¾—æˆ‘ä»¬åœ¨ç»™ä»–ä»¬åšâ€œæ¨èâ€ã€‚

è¿™ä¸ªMapï¼Œå¸¸å¸¸è¢«äººç§°ä¸ºâ€œç´¢å¼•â€ã€‚å…¶å®ä½¿ç”¨â€œç´¢å¼•â€ è¿™ä¸ªåè¯ä¹Ÿæ›´å‡†ç¡®ä¸€äº›ã€‚Mapä¸­çš„Keyæ˜¯ä¸èƒ½é‡å¤çš„ã€‚ä½†æ˜¯æˆ‘ä»¬æ•°æ®ç»“æ„æ˜¯è¦æ±‚å¯é‡å¤çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºï¼Œåœ¨ç³»ç»Ÿä¸­ï¼Œsã€shã€shenã€æ·±ç­‰ç­‰è¿™äº›éƒ½æ˜¯keyï¼Œè€Œå®ƒä»¬å¯¹åº”çš„valueï¼Œå¯èƒ½ç›¸åŒï¼Œåˆå¯èƒ½ä¸åŒã€‚ä¸¾ä¸ªä¾‹å­ï¼š

```
hotword:0>zrevrange s 0 10
1) é¼ è›Ÿ
2) é¼ åœºä¹¡
3) é³é±¼
4) é³æºªæ ¡åŒº
5) é³æºªå†œåœº
6) é³æºª
7) éªšå­è¥ç¤¾åŒº
8) éªšå­è¥
9) é©·é©¬é•‡
10) é©·é©¬æ¡¥è¡—é“
11) é©·é©¬æ¡¥
```

```
hotword:0>zrevrange sh 0 10
1) é¼ è›Ÿ
2) é¼ åœºä¹¡
3) é³é±¼
4) é³æºªæ ¡åŒº
5) é³æºªå†œåœº
6) é³æºª
7) é¦–é™¢èƒ¡åŒ
8) é¦–é˜³é•‡
9) é¦–é˜³å±±é•‡
10) é¦–é˜³å±±
11) é¦–é’¢è¯•éªŒå‚
```

ä»”ç»†çœ‹åˆ°å…¶ä¸­çš„ä¸åŒäº†å—ï¼ŸåŒæ—¶ï¼Œè¿™é‡Œè¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å½“ç”¨æˆ·è¾“å…¥sæ—¶ï¼Œå‡ºç°äº†10ä¸ªvalueï¼Œæˆ‘ä»¬å¦‚ä½•ç»™è¿™äº›valueå¦‚ä½•æ’åºå‘¢ï¼Ÿ

ä¸ºäº†ä¸æ’åºæ¨¡å‹è§£è€¦ï¼Œæˆ‘ä»¬ä¸ºæ¯ä¸ªvalueéƒ½ç»™å‡ºä¸€ä¸ªåˆ†æ•°scoreã€‚scoreè¶Šå¤§ï¼Œè¶Šæ’å‰é¢ã€‚æœ€ç»ˆç´¢å¼•ç»“æ„å°±å˜æˆäº†è¿™æ ·å­ï¼š

![](/assets/images/key-value-score.png)

P.S. è¿™äº›scoreä¹‹æ‰€ä»¥éƒ½ä¸º0ï¼Œæ˜¯å› ä¸ºæ•°æ®é—®é¢˜ã€‚

æ€»çš„æ¥è¯´ï¼Œå…³äºçƒ­è¯æ¨èï¼Œæˆ‘ä»¬éœ€è¦è§£å†³ä»¥ä¸‹é—®é¢˜ï¼š

  * å¦‚ä½•å­˜å‚¨ç´¢å¼•çš„æ•°æ®ï¼Ÿ

  * å¦‚ä½•æ„å»ºç´¢å¼•ï¼Ÿä¹Ÿå°±æ˜¯ä¸€å¼€å§‹æ—¶ï¼Œæˆ‘ä»¬æ€ä¹ˆçŸ¥é“ç”¨æˆ·è¾“å…¥â€œsâ€ å°±æ˜¯è¦æœâ€œæ·±åœ³â€å‘¢ï¼Ÿ

  * å¦‚ä½•æ ¹æ®ç”¨æˆ·çš„åé¦ˆè¡Œä¸ºæ¥æ›´æ–°ç´¢å¼•ï¼Ÿå½“ç”¨æˆ·è¾“å…¥ â€œsâ€ å‡ºç°äº†â€œ1 æ²™æ²³â€å’Œâ€œ2 æ·±åœ³â€ï¼Œç”¨æˆ·é€‰æ‹©äº†â€œæ·±åœ³â€ï¼Œé‚£ä¹ˆå½“å…¶ä»–ç”¨æˆ·è¾“å…¥â€œsâ€æ—¶ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯åº”è¯¥å°†â€œæ·±åœ³â€è¿™ä¸ªè¯æ”¾åˆ°å‰é¢å‘¢ï¼Ÿ

  â€‹

#### åŸºäºSolrå®ç°çš„å¼Šç«¯

 ç¾å›¢åœ¨å‡ å¹´å‰ä¹Ÿå†™äº†ä¸€ç¯‡æ–‡ç« æ¥ä»‹ç»è‡ªå·±çš„çƒ­è¯æ¨èï¼š[æœç´¢å¼•æ“å…³é”®å­—æ™ºèƒ½æç¤ºçš„ä¸€ç§å®ç°](http://blog.jobbole.com/95802/)ã€‚ç„¶è€Œè¿™ç§å®ç°ï¼Œä¸ªäººè§‰å¾—æœ‰ä¸ªè®¾è®¡éå¸¸ä¸å¥½ã€‚å› ä¸ºSolråœ¨æ•´ä¸ªç³»ç»Ÿä¸­ï¼Œå³åšäº†â€œå­˜å‚¨ç´¢å¼•â€çš„è§’è‰²ï¼Œåˆåšäº†â€œæ„å»ºç´¢å¼•â€çš„è§’è‰²ã€‚è¿åäº†èŒè´£å•ä¸€åŸåˆ™ã€‚å› ä¸ºå½“æˆ‘ä»¬æƒ³æ”¹å˜æ„å»ºç´¢å¼•çš„ç®—æ³•æ—¶ï¼ŒåŒæ—¶ä¼šå½±å“åˆ°â€œå­˜å‚¨ç´¢å¼•â€çš„é€»è¾‘ã€‚

ä»¥ä¸‹æ˜¯ä»–ä»¬çš„å®ç°é€»è¾‘æˆªå›¾ï¼š

![](/assets/images/meituan.png)

#### å¦ä¸€ç§åŸºäºRedisçš„å®ç°

æˆ‘ç›®å‰åªå†™äº†ä¸€ä¸ªç®€å•å®ç°ï¼Œè€Œä¸”è¿˜æ²¡æœ‰å®ç°â€œæ ¹æ®ç”¨æˆ·åé¦ˆæ¥æ›´æ–°ç´¢å¼•â€çš„åŠŸèƒ½ã€‚è¿™ä¸ªåŠŸèƒ½å¯å®ç°å¾—å¾ˆç®€å•ï¼Œä¹Ÿå¯ä»¥å®ç°å¾—å¾ˆå¤æ‚ã€‚æœ¬æ–‡ä¸è®¨è®ºã€‚

åŒæ—¶ï¼Œç”Ÿäº§ç¯å¢ƒä¼šæ›´å¤æ‚ä¸€äº›ã€‚æ¯”å¦‚è¦å®ç°é«˜å¯ç”¨ã€‚æˆ‘ä¸ªäººèƒ½åŠ›æœ‰é™ï¼Œè¿˜æ²¡æœ‰èƒ½å®ç°ã€‚ä½†æ˜¯æ€è·¯æ˜¯æœ‰çš„ï¼šæ‰€æœ‰å‡ºç°å•ç‚¹çš„åœ°æ–¹éƒ½è¦åšæˆåˆ†å¸ƒå¼çš„ï¼Œæ¯”å¦‚Rediså°±åšæˆRedis Clusterã€‚

ä»¥ä¸‹æ˜¯æ¶æ„å›¾ï¼š

![](/assets/images/architecture.png)

å›¾ä¸­ï¼ŒInitWorkerè´Ÿè´£å°†æˆ‘å‡†å¤‡å¥½çš„å…¨å›½åœ°åå¤§å…¨çš„æ•°æ®ï¼Œæ„å»ºæˆç´¢å¼•ï¼Œç„¶åå†™åˆ°Redisä¸­ã€‚ç”¨æˆ·åˆ™å¯ä»¥é€šè¿‡åŸºäºOpenrestyå†™çš„APPå»æŸ¥è¯¢Redisä¸­çš„æ•°æ®ã€‚

ä½¿ç”¨æœ¬ç³»ç»Ÿçš„æ–¹æ³•ï¼š

> P.S. æœ¬ç³»ç»Ÿä½¿ç”¨Ansibleåšè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ‰€ä»¥ï¼Œè¯·æå‰å®‰è£…å¥½Ansibleã€‚

1. git clone https://github.com/zacker330/hot-word-recommend.git
2. å‡†å¤‡ä¸¤ä¸ªUbuntu 16çš„æœºå™¨ï¼Œå¦‚æœä½ æ‡‚Vagrantçš„è¯ï¼Œç›´æ¥ä½¿ç”¨æˆ‘çš„Vagrantfileå°±å¥½äº†
3. è¿›å…¥åˆ°é¡¹ç›®ä¸­ï¼Œæ‰§è¡Œ`ansible-playbook ./ansible/playbook.yml -i ./ansible/inventory -u vagrant -k` æ¥è‡ªåŠ¨åŒ–éƒ¨ç½²æ‰€æœ‰ç»„ä»¶ã€‚å¦‚æœä½¿ç”¨Vagrantæ¥æ­å»ºçš„ç¯å¢ƒï¼Œå¯†ç æ˜¯ vagrantï¼Œä»¥ä¸‹åŒï¼Œå°†ä¸åœ¨é‡è¿°ã€‚
4. æ‰“åŒ…æˆ‘ä»¬çš„InitWorkeré¡¹ç›®ï¼š`mvn assembly:assembly`
5. éƒ¨ç½²InitWorker: `ansible-playbook ./ansible/deploy-worker.yml -i ./ansible/inventory -u vagrant -k`
6. æ‰“å¼€é“¾æ¥æµ‹è¯•ï¼šhttp://192.168.10.11/index.lsp ã€‚IPæ¢æˆä½ è‡ªå·±éƒ¨ç½²çš„æœºå™¨çš„IPã€‚

å…·ä½“ä»£ç ï¼Œè‡ªå·±çœ‹äº†ã€‚ä¸ºæ–¹ä¾¿é˜…è¯»ï¼Œæˆ‘è§‰å¾—æœ‰å¿…è¦æ³¨é‡Šä¸€ä¸‹é¡¹ç›®ç»“æ„ï¼š

```
â”œâ”€â”€ README.md
â”œâ”€â”€ Vagrantfile
â”œâ”€â”€ ansible
â”‚Â Â  â”œâ”€â”€ deploy-front-app.yml // å•ç‹¬éƒ¨ç½² å‰ç«¯app
â”‚Â Â  â”œâ”€â”€ deploy-local.yml //æœ¬åœ°å¼€å‘ä½¿ç”¨
â”‚Â Â  â”œâ”€â”€ deploy-worker.yml // æ‰§è¡Œworkerï¼Œå†™ç´¢å¼•åˆ°redisä¸­
â”‚Â Â  â”œâ”€â”€ inventory
â”‚Â Â  â”œâ”€â”€ playbook.yml // å®‰è£…æ‰€æœ‰å¿…è¦çš„ç»„ä»¶
â”‚Â Â  â”œâ”€â”€ roles
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ common
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ front-app // å®‰è£…å‰ç«¯APP
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ jdk8 // å®‰è£…Jdk8
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ openresty // å®‰è£…Openresty
â”‚Â Â  â”‚Â Â  â””â”€â”€ redis // å®‰è£…redisçš„è„šæœ¬
â”‚Â Â  â””â”€â”€ vars
â”‚Â Â      â””â”€â”€ base-env.yml  // é…ç½®å˜é‡å­˜æ”¾æ–‡ä»¶
â”œâ”€â”€ autocomplete-worker
â”‚Â Â  â”œâ”€â”€ pom.xml
â”‚Â Â  â”œâ”€â”€ src
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”œâ”€â”€ java
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ codes
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ showme
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â          â””â”€â”€ autocomplete
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â              â”œâ”€â”€ InitWorker.java    
â”‚Â Â  â”‚Â Â  â”‚Â Â  â”‚Â Â              â””â”€â”€ common
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ resources
â”‚Â Â  â”‚Â Â  â”‚Â Â      â””â”€â”€ env.properties
â”‚Â Â  â”‚Â Â  â””â”€â”€ test
â”‚Â Â  â””â”€â”€ target
â”œâ”€â”€ doc // æ–‡æ¡£éœ€è¦ç”¨åˆ°çš„ä¸€äº›æ–‡ä»¶
â””â”€â”€ files
    â””â”€â”€ places.txt.zip  //å…¨å›½åœ°åæ•°æ®
```



#### å°ç»“

çƒ­è¯æ¨èçš„â€œæ™ºèƒ½â€æ‰€åœ¨å¤„å°±åœ¨äºç´¢å¼•çš„æ„å»ºç®—æ³•ã€‚ç®€å•ä¸€ç‚¹çš„åšæ³•å°±æ˜¯æ¯å½“ç”¨æˆ·ç‚¹å‡»æŸæœç´¢ç»“æœæ—¶ï¼Œæˆ‘ä»¬å°±ç»™è¿™ä¸ªç´¢å¼•æ¡ç›®åŠ æƒ1ã€‚æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å®ç°æ¥ç©ç©ã€‚

ä»¥ä¸Šå†…å®¹å‡ä¸ºä¸ªäººçœ‹æ³•ï¼Œå¦‚æœæœ‰ä¸å¯¹çš„åœ°æ–¹ï¼Œè¿˜è¯·æ–§æ­£ï¼Œè°¢è°¢äº†ã€‚
